<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebaseæ¥ç¶šãƒ†ã‚¹ãƒˆ - Tomyum Kitchen</title>
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #dc2626;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #b91c1c;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #dc2626;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .error {
            border-left-color: #dc2626;
            background: #fee2e2;
        }
        .success {
            border-left-color: #16a34a;
            background: #d1fae5;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¥ Firebaseæ¥ç¶šãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>1. FirebaseåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testFirebaseInit()">FirebaseåˆæœŸåŒ–ã‚’ãƒ†ã‚¹ãƒˆ</button>
        <div id="initResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Firestoreæ¥ç¶šãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testFirestoreConnection()">Firestoreæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ</button>
        <div id="firestoreResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. äºˆç´„ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testReservations()">äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿</button>
        <div id="reservationsResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testOrders()">æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿</button>
        <div id="ordersResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>5. Firestoreãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testFirestoreRules()">ãƒ«ãƒ¼ãƒ«ã‚’ãƒ†ã‚¹ãƒˆ</button>
        <div id="rulesResult" class="result"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, query, orderBy, limit, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyCnxcVvjWVJB9lTR1ZI7QnhtVr6sGqM2jI",
            authDomain: "tomyumkitchen-61a11.firebaseapp.com",
            projectId: "tomyumkitchen-61a11",
            storageBucket: "tomyumkitchen-61a11.firebasestorage.app",
            messagingSenderId: "329516809259",
            appId: "1:329516809259:web:admin-dashboard"
        };

        let app = null;
        let db = null;

        window.testFirebaseInit = async function() {
            const resultDiv = document.getElementById('initResult');
            try {
                resultDiv.textContent = 'FirebaseåˆæœŸåŒ–ä¸­...';
                resultDiv.className = 'result';
                
                app = initializeApp(firebaseConfig);
                resultDiv.textContent = 'âœ… FirebaseåˆæœŸåŒ–æˆåŠŸï¼\n' + JSON.stringify(firebaseConfig, null, 2);
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.textContent = 'âŒ FirebaseåˆæœŸåŒ–å¤±æ•—\n' + error.message;
                resultDiv.className = 'result error';
            }
        };

        window.testFirestoreConnection = async function() {
            const resultDiv = document.getElementById('firestoreResult');
            try {
                resultDiv.textContent = 'Firestoreæ¥ç¶šä¸­...';
                resultDiv.className = 'result';
                
                if (!app) {
                    app = initializeApp(firebaseConfig);
                }
                
                db = getFirestore(app);
                resultDiv.textContent = 'âœ… Firestoreæ¥ç¶šæˆåŠŸï¼\nãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: ' + db.app.name;
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.textContent = 'âŒ Firestoreæ¥ç¶šå¤±æ•—\n' + error.message;
                resultDiv.className = 'result error';
            }
        };

        window.testReservations = async function() {
            const resultDiv = document.getElementById('reservationsResult');
            try {
                resultDiv.textContent = 'äºˆç´„ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...';
                resultDiv.className = 'result';
                
                if (!db) {
                    if (!app) app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                }
                
                const reservationsRef = collection(db, 'reservations');
                const q = query(reservationsRef, orderBy('createdAt', 'desc'), limit(5));
                const snapshot = await getDocs(q);
                
                let result = `âœ… äºˆç´„ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸï¼\nå–å¾—ä»¶æ•°: ${snapshot.size}ä»¶\n\n`;
                
                if (snapshot.empty) {
                    result += 'âš ï¸ äºˆç´„ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“\n';
                    result += 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§äºˆç´„ã‚’ä½œæˆã—ã¦ã‹ã‚‰å†ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„';
                } else {
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        result += `ID: ${doc.id}\n`;
                        result += `é¡§å®¢å: ${data.customerName}\n`;
                        result += `é›»è©±: ${data.phone}\n`;
                        result += `æ—¥æ™‚: ${new Date(data.date.seconds * 1000).toLocaleString('ja-JP')}\n`;
                        result += `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${data.status}\n`;
                        result += `ä½œæˆæ—¥: ${new Date(data.createdAt.seconds * 1000).toLocaleString('ja-JP')}\n\n`;
                    });
                }
                
                resultDiv.textContent = result;
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.textContent = 'âŒ äºˆç´„ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—\n' + error.message + '\n\n' + error.stack;
                resultDiv.className = 'result error';
            }
        };

        window.testOrders = async function() {
            const resultDiv = document.getElementById('ordersResult');
            try {
                resultDiv.textContent = 'æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...';
                resultDiv.className = 'result';
                
                if (!db) {
                    if (!app) app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                }
                
                const ordersRef = collection(db, 'orders');
                const q = query(ordersRef, orderBy('createdAt', 'desc'), limit(5));
                const snapshot = await getDocs(q);
                
                let result = `âœ… æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸï¼\nå–å¾—ä»¶æ•°: ${snapshot.size}ä»¶\n\n`;
                
                if (snapshot.empty) {
                    result += 'âš ï¸ æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“\n';
                    result += 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§æ³¨æ–‡ã‚’ä½œæˆã—ã¦ã‹ã‚‰å†ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„';
                } else {
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        result += `ID: ${doc.id}\n`;
                        result += `é¡§å®¢å: ${data.customerInfo.name}\n`;
                        result += `é›»è©±: ${data.customerInfo.phone}\n`;
                        result += `é‡‘é¡: Â¥${data.total.toLocaleString()}\n`;
                        result += `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${data.status}\n`;
                        result += `ä½œæˆæ—¥: ${new Date(data.createdAt.seconds * 1000).toLocaleString('ja-JP')}\n\n`;
                    });
                }
                
                resultDiv.textContent = result;
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.textContent = 'âŒ æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—\n' + error.message + '\n\n' + error.stack;
                resultDiv.className = 'result error';
            }
        };

        window.testFirestoreRules = async function() {
            const resultDiv = document.getElementById('rulesResult');
            try {
                resultDiv.textContent = 'Firestoreãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆä¸­...';
                resultDiv.className = 'result';
                
                if (!db) {
                    if (!app) app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                }
                
                // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãƒ«ãƒ¼ãƒ«ã‚’ãƒ†ã‚¹ãƒˆ
                const testRef = doc(db, 'test', 'rule-test');
                
                try {
                    await getDoc(testRef);
                    resultDiv.textContent = 'âœ… Firestoreãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆæˆåŠŸï¼\nèª­ã¿å–ã‚Šæ¨©é™ãŒã‚ã‚Šã¾ã™\n\næ¨å¥¨ãƒ«ãƒ¼ãƒ«:\n' +
                        'rules_version = \'2\';\n' +
                        'service cloud.firestore {\n' +
                        '  match /databases/{database}/documents {\n' +
                        '    match /{document=**} {\n' +
                        '      allow read: if true;\n' +
                        '    }\n' +
                        '  }\n' +
                        '}';
                    resultDiv.className = 'result success';
                } catch (error) {
                    resultDiv.textContent = 'âŒ Firestoreãƒ«ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼\n' + error.message + '\n\nFirebase Consoleã§ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„';
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.textContent = 'âŒ Firestoreãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆå¤±æ•—\n' + error.message;
                resultDiv.className = 'result error';
            }
        };

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ãƒ†ã‚¹ãƒˆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Firebaseæ¥ç¶šãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            setTimeout(() => {
                testFirebaseInit();
            }, 1000);
        });
    </script>
</body>
</html>
